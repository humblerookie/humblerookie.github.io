{"componentChunkName":"component---src-templates-post-template-post-template-tsx","path":"/posts/optimizing-flutter-buildrunner/","result":{"data":{"markdownRemark":{"id":"ae5f2db6-fe5b-5137-a5bc-a4c7f49b2046","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bc25700b1be582b5b5e421310b1b4e9c/b8471/banner.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.833333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9ElEQVQY041Qu07EMBD0p/MBtFR8CwUFEicaSjioCErsyyXxI7Ed27uL7FwuKUBiZFmzM6PdtRkAICKU8xeIaCWZL0BEdvHWepejVcfDoL9tIKK6rnhz7KfYGx8SMCg5FbEPW5c9gvMvleB+zjFxsPrLRZp8AERGiBHxrqHndhpEI04t51xKuQ1PhDFzsO9wuqH58dqXAQAR3b+NDx9np/q64UKIruuuWzvfDvrzbNLQHX11G/RTSDSoLqbIUoKSCGr05cHbfyBma56NGRvtoplMUK+AOAdvnQUARv9HGgncXmBSSqWUlGohv+FiSqmXskj5/gHD6M9+Dw9FDwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/bc25700b1be582b5b5e421310b1b4e9c/8ac56/banner.webp 240w,\n/static/bc25700b1be582b5b5e421310b1b4e9c/d3be9/banner.webp 480w,\n/static/bc25700b1be582b5b5e421310b1b4e9c/e46b2/banner.webp 960w,\n/static/bc25700b1be582b5b5e421310b1b4e9c/f992d/banner.webp 1440w,\n/static/bc25700b1be582b5b5e421310b1b4e9c/882b9/banner.webp 1920w,\n/static/bc25700b1be582b5b5e421310b1b4e9c/c76db/banner.webp 2016w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/bc25700b1be582b5b5e421310b1b4e9c/8ff5a/banner.png 240w,\n/static/bc25700b1be582b5b5e421310b1b4e9c/e85cb/banner.png 480w,\n/static/bc25700b1be582b5b5e421310b1b4e9c/d9199/banner.png 960w,\n/static/bc25700b1be582b5b5e421310b1b4e9c/07a9c/banner.png 1440w,\n/static/bc25700b1be582b5b5e421310b1b4e9c/29114/banner.png 1920w,\n/static/bc25700b1be582b5b5e421310b1b4e9c/b8471/banner.png 2016w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/bc25700b1be582b5b5e421310b1b4e9c/d9199/banner.png\"\n            alt=\"Banner graphic Flutter codegen optimization\"\n            title=\"Banner graphic Flutter codegen optimization\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>In the <a href=\"/posts/optimizing-flutter-tests/\">last article</a>, we explored techniques to speed up Flutter test execution. Now, let’s take a look at another area for optimization in the Flutter environment i.e. <a href=\"https://pub.dev/packages/build_runner\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">build runner</a>.</p>\n<h2 id=\"motivation\" style=\"position:relative;\"><a href=\"#motivation\" aria-label=\"motivation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Motivation</h2>\n<p>I’ve been using generators to get rid of boiler plate code for some time now. Be it json decoding, immutable classes using <a href=\"https://pub.dev/packages/freezed/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Freezed</a> or mock objects in my tests. The trouble is the build runner takes a lot of time to run, sometimes disproportionate to the changes made. I’ve tried using the <code class=\"language-text\">watch</code> feature of the runner but it crashes a lot of the time rendering it less useful.</p>\n<p>Let’s see if there’s another way to alleviate these problems by exploring the build runner.</p>\n<h2 id=\"partial-builds\" style=\"position:relative;\"><a href=\"#partial-builds\" aria-label=\"partial builds permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Partial Builds</h2>\n<p>When looking at the build runner’s <a href=\"https://github.com/dart-lang/build/blob/master/docs/partial_builds.md\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">documentation</a>, I came across a parameter called <code class=\"language-text\">build-filter</code> which is documented as follows</p>\n<blockquote>\n<p>Whenever a build filter is provided, only required outputs matching one of the build filters will be built, in addition to any required files for those outputs.</p>\n</blockquote>\n<p>While we may not be able to speed up a fresh codegen cycle, we could leverage this parameter to speed up incremental builds to ensure we only run the build runner on the diff. So let’s set up the script.</p>\n<h2 id=\"calculating-changed-files\" style=\"position:relative;\"><a href=\"#calculating-changed-files\" aria-label=\"calculating changed files permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Calculating Changed Files</h2>\n<p>We start by figuring out which files have changed. Linux, offers a nice solution to figure out the files changed since a particular time</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">find</span> <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">-type</span> f <span class=\"token parameter variable\">-mmin</span> <span class=\"token number\">2</span></code></pre></div>\n<p>This would give us the actual files that were updated in the current directory since the last 2 minutes.</p>\n<p>In order to use this, we need to store an epoch timestamp to know when we’d last run the incremental build. So let’s create a temporary file <code class=\"language-text\">build.timestamp</code> that gets updated with the current timestamp everytime we invoke our build script. Let’s add it to our script.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-f</span>  build.timestamp <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Running incremental build\"</span>\n    <span class=\"token assign-left variable\">log_time</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">cat</span> build.timestamp <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">'s/^[   ]*//;s/[    ]*$//'</span><span class=\"token variable\">)</span></span>\n<span class=\"token keyword\">else</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Running build first time\"</span>\n    dart run build_runner build\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token function\">date</span> +<span class=\"token string\">\"%s\"</span> <span class=\"token operator\">></span> build.timestamp</code></pre></div>\n<p>So, all this script does is checks for existence of a file called <code class=\"language-text\">build.timestamp</code> and reads the value of epoch timestamp into <code class=\"language-text\">log_time</code>. If it doesn’t find the file ,we’ve run the build runner on the entire project. Lastly, we emit the updated timestamp into the file.</p>\n<p>Next, we need to calculate the delta in minutes and pipe it into our <code class=\"language-text\">find</code> command as shown below</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token assign-left variable\">current_epoch</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +%s<span class=\"token variable\">)</span></span>\n<span class=\"token assign-left variable\">difference_seconds</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$((</span>current_epoch <span class=\"token operator\">-</span> log_time<span class=\"token variable\">))</span></span>\n<span class=\"token assign-left variable\">diff_mins</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"scale=2; <span class=\"token variable\">$difference_seconds</span> / 60\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">bc</span><span class=\"token variable\">)</span></span>\n<span class=\"token assign-left variable\">diff_mins_rounded_up</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token variable\">$diff_mins</span> + 0.9999\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">bc</span> <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token string\">'{printf \"%.0f\\n\", $1}'</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token assign-left variable\">changed_files</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">find</span> <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">-type</span> f <span class=\"token parameter variable\">-mmin</span> <span class=\"token string\">\"-<span class=\"token variable\">$diff_mins_rounded_up</span>\"</span><span class=\"token variable\">)</span></span></code></pre></div>\n<blockquote>\n<p>ⓘ Note: We’ve ceiled up the difference in order to avoid missing any changed files.</p>\n</blockquote>\n<h2 id=\"filtering-noise\" style=\"position:relative;\"><a href=\"#filtering-noise\" aria-label=\"filtering noise permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Filtering Noise</h2>\n<p>Now that we have a list of all files that changed we would only want to retain files belonging to the “lib” and “test” folders. So let’s update the <code class=\"language-text\">changed_files</code> field</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token assign-left variable\">changed_files</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">find</span> <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">-type</span> f <span class=\"token parameter variable\">-mmin</span> <span class=\"token string\">\"-<span class=\"token variable\">$diff_mins_rounded_up</span>\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token parameter variable\">-E</span> <span class=\"token string\">\"^\\.\\/(lib\\/|test\\/)\"</span><span class=\"token variable\">)</span></span></code></pre></div>\n<p>Next, we would want to map the file paths with wildcard <code class=\"language-text\">*</code> so that we use both the source file and the generated files(eg. <strong><em>file.g.dart, file.freezed.dart</em></strong> etc) as inputs to the build runner i.e. convert<code class=\"language-text\">lib/main.dart</code> to <code class=\"language-text\">lib/main*.dart</code>. We can do this using <code class=\"language-text\">sed</code> as follows</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token assign-left variable\">changed_files</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">find</span> <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">-type</span> f <span class=\"token parameter variable\">-mmin</span> <span class=\"token string\">\"-<span class=\"token variable\">$diff_mins_rounded_up</span>\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token parameter variable\">-E</span> <span class=\"token string\">\"^\\.\\/(lib\\/|test\\/)\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">'s/\\.dart$/*\\.dart/'</span><span class=\"token variable\">)</span></span>\n</code></pre></div>\n<h2 id=\"finishing-up\" style=\"position:relative;\"><a href=\"#finishing-up\" aria-label=\"finishing up permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Finishing up</h2>\n<p>Finally, we need to map these file paths into the <code class=\"language-text\">build_filter</code> parameter and generate the final command that needs to be executed which would look something like below</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dart run build_runner build <span class=\"token punctuation\">\\</span>\n  --build-filter<span class=\"token operator\">=</span><span class=\"token string\">\"lib/main.dart\"</span> <span class=\"token punctuation\">\\</span>\n  --build-filter<span class=\"token operator\">=</span><span class=\"token string\">\"test/main_bloc_test.dart\"</span></code></pre></div>\n<p>We can do that by using <code class=\"language-text\">sed</code> in the manner shown below</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token assign-left variable\">changed_files</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">find</span> <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">-type</span> f <span class=\"token parameter variable\">-mmin</span> <span class=\"token string\">\"-<span class=\"token variable\">$diff_mins_rounded_up</span>\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token parameter variable\">-E</span> <span class=\"token string\">\"^\\.\\/(lib\\/|test\\/)\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">'s/\\.dart$/*\\.dart/'</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">\"s/^/ --build-filter=<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>/ ; s/$/<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>/\"</span><span class=\"token variable\">)</span></span>\n<span class=\"token assign-left variable\">command</span><span class=\"token operator\">=</span><span class=\"token string\">\"dart run build_runner build <span class=\"token variable\">$changed_files</span>\"</span>\n<span class=\"token builtin class-name\">eval</span> <span class=\"token string\">\"<span class=\"token variable\">$command</span>\"</span></code></pre></div>\n<p>I’ve left out some formatting commands for simplicity, However, you may find the full script below</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># incremental_build.sh</span>\n<span class=\"token builtin class-name\">set</span> <span class=\"token parameter variable\">-e</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-f</span>  build.timestamp <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Running incremental build\"</span>\n    <span class=\"token assign-left variable\">log_time</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">cat</span> build.timestamp <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">'s/^[   ]*//;s/[    ]*$//'</span><span class=\"token variable\">)</span></span>\n    <span class=\"token assign-left variable\">human_readable_time</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> <span class=\"token parameter variable\">-r</span> $log_time<span class=\"token variable\">)</span></span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Last build time: <span class=\"token variable\">$human_readable_time</span>\"</span>\n    <span class=\"token assign-left variable\">current_epoch</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +%s<span class=\"token variable\">)</span></span>\n    <span class=\"token assign-left variable\">difference_seconds</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$((</span>current_epoch <span class=\"token operator\">-</span> log_time<span class=\"token variable\">))</span></span>\n    <span class=\"token assign-left variable\">diff_mins</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"scale=2; <span class=\"token variable\">$difference_seconds</span> / 60\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">bc</span><span class=\"token variable\">)</span></span>\n    <span class=\"token assign-left variable\">diff_mins_rounded_up</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token variable\">$diff_mins</span> + 0.9999\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">bc</span> <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token string\">'{printf \"%.0f\\n\", $1}'</span><span class=\"token variable\">)</span></span>\n    <span class=\"token assign-left variable\">changed_files</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">find</span> <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">-type</span> f <span class=\"token parameter variable\">-mmin</span> <span class=\"token string\">\"-<span class=\"token variable\">$diff_mins_rounded_up</span>\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token parameter variable\">-E</span> <span class=\"token string\">\"^\\.\\/(lib\\/|test\\/)\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">\"s/^\\.\\///\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">'s/\\.dart$/*\\.dart/'</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-E</span> <span class=\"token string\">'/^$/d'</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">\"s/^/ --build-filter=<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>/ ; s/$/<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>/\"</span><span class=\"token variable\">)</span></span>\n    <span class=\"token assign-left variable\">count</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">wc</span> <span class=\"token parameter variable\">-l</span> <span class=\"token operator\">&lt;&lt;&lt;</span> <span class=\"token string\">\"<span class=\"token variable\">$changed_files</span>\"</span><span class=\"token variable\">)</span></span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Changed files: <span class=\"token variable\">$count</span>\"</span>\n    <span class=\"token assign-left variable\">changed_files</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">${changed_files<span class=\"token operator\">/</span><span class=\"token operator\">/</span>$'\\n'<span class=\"token operator\">/</span>}</span>\"</span>\n    <span class=\"token assign-left variable\">command</span><span class=\"token operator\">=</span><span class=\"token string\">\"dart run build_runner build <span class=\"token variable\">$changed_files</span>\"</span>\n    <span class=\"token builtin class-name\">eval</span> <span class=\"token string\">\"<span class=\"token variable\">$command</span>\"</span>\n<span class=\"token keyword\">else</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Running build first time\"</span>\n    dart run build_runner build\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token function\">date</span> +<span class=\"token string\">\"%s\"</span> <span class=\"token operator\">></span> build.timestamp</code></pre></div>\n<h2 id=\"measuring-gains\" style=\"position:relative;\"><a href=\"#measuring-gains\" aria-label=\"measuring gains permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Measuring Gains</h2>\n<p>Now that we have our script, let’s see the performance gains. I’ve updated two dart files and ran</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">time</span> dart run build_runner build\n\n<span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> Succeeded after 1m 30s with <span class=\"token number\">66</span> outputs <span class=\"token punctuation\">(</span><span class=\"token number\">900</span> actions<span class=\"token punctuation\">)</span>\n\ndart run build_runner build  <span class=\"token number\">111</span>.00s user <span class=\"token number\">4</span>.93s system <span class=\"token number\">120</span>% cpu <span class=\"token number\">1</span>:35.87 total</code></pre></div>\n<p>Now let’s see how long it our new script fares</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">time</span> ./incremental_build.sh\nRunning incremental build\nLast build time: Tue Apr <span class=\"token number\">23</span> <span class=\"token number\">10</span>:26:53 IST <span class=\"token number\">2024</span>\n\n<span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> Succeeded after <span class=\"token number\">35</span>.5s with <span class=\"token number\">66</span> outputs <span class=\"token punctuation\">(</span><span class=\"token number\">79</span> actions<span class=\"token punctuation\">)</span>\n\n./incremental_build.sh  <span class=\"token number\">49</span>.17s user <span class=\"token number\">3</span>.69s system <span class=\"token number\">127</span>% cpu <span class=\"token number\">41.344</span> total</code></pre></div>\n<p>We’ve reduced the build time by less than half of what it was earlier 😱.</p>\n<p>Hope you’ve found this useful. Happy scripting folks.</p>","fields":{"slug":"/posts/2024-04-13---Optimizing-Flutter-Build-Runner//posts/optimizing-flutter-buildrunner/","tagSlugs":["/tag/flutter/","/tag/android/","/tag/ios/"]},"frontmatter":{"date":"2024-04-23T16:51:00.000Z","description":"Let's take a look at build runner for codegen and how we could speed it up.","tags":["Flutter","Android","Ios"],"title":"Optimizing Flutter - Part 2: Build Runner","socialImage":{"publicURL":"/static/bc25700b1be582b5b5e421310b1b4e9c/banner.png"}}}},"pageContext":{"slug":"/posts/2024-04-13---Optimizing-Flutter-Build-Runner//posts/optimizing-flutter-buildrunner/"}},"staticQueryHashes":["251939775","288581551","401334301"]}